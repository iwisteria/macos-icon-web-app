<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>macOSã‚¢ã‚¤ã‚³ãƒ³ä½œæˆãƒ„ãƒ¼ãƒ«</title>

    <!-- Apple Touch Icons for iOS and macOS -->
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icons/apple-touch-icon-167x167.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/apple-touch-icon-120x120.png">

    <!-- Favicons for various browsers -->
    <link rel="icon" href="icons/favicon.ico">
    <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="shortcut icon" href="icons/favicon.ico">

    <!-- Android Chrome icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icons/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icons/android-chrome-512x512.png">

    <!-- Web App Manifest for PWA support -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="macOSã‚¢ã‚¤ã‚³ãƒ³ä½œæˆ">

    <!-- Microsoft Tiles -->
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-TileImage" content="icons/apple-touch-icon-152x152.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .main-content {
            padding: 40px;
        }

        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #fafafa;
        }

        .upload-area:hover, .upload-area.dragover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .upload-area.has-file {
            border-color: #4CAF50;
            background: #f8fff8;
        }

        .upload-icon {
            font-size: 4em;
            color: #ddd;
            margin-bottom: 20px;
        }

        .upload-area.dragover .upload-icon,
        .upload-area:hover .upload-icon {
            color: #667eea;
        }

        .upload-area.has-file .upload-icon {
            color: #4CAF50;
        }

        .upload-text {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #999;
            font-size: 0.9em;
        }

        .preview-section {
            display: none;
            margin-bottom: 30px;
        }

        .preview-container {
            display: flex;
            align-items: center;
            gap: 20px;
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
        }

        .preview-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 10px;
            border: 2px solid #ddd;
        }

        .preview-info {
            flex: 1;
        }

        .preview-info h3 {
            margin-bottom: 5px;
            color: #333;
        }

        .preview-info p {
            color: #666;
            margin-bottom: 3px;
        }

        .settings-section {
            display: none;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .generate-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 100%;
            font-weight: 500;
        }

        .generate-button:hover {
            transform: translateY(-2px);
        }

        .generate-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .progress-section {
            display: none;
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            color: #666;
        }

        .results-section {
            display: none;
            margin-top: 30px;
        }

        .size-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .size-item {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #eee;
        }

        .size-item img {
            width: 64px;
            height: 64px;
            object-fit: cover;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .size-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .download-section {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .download-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            transition: background 0.3s ease;
        }

        .download-button:hover {
            background: #45a049;
        }

        .reset-button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }

        .reset-button:hover {
            background: #ff5252;
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #c62828;
            display: none;
        }

        .warning-box {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }

        @media (max-width: 600px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .size-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ macOSã‚¢ã‚¤ã‚³ãƒ³ä½œæˆãƒ„ãƒ¼ãƒ«</h1>
            <p>PNGç”»åƒã‹ã‚‰è‡ªå‹•ã§macOSç”¨ã‚¢ã‚¤ã‚³ãƒ³ã‚»ãƒƒãƒˆã‚’ç”Ÿæˆ</p>
        </div>

        <div class="main-content">
            <div class="warning-box">
                <strong>âš ï¸ é‡è¦:</strong> PNGå½¢å¼ã®ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ1024Ã—1024pxä»¥ä¸Šæ¨å¥¨ï¼‰ã‚’ã”ç”¨æ„ãã ã•ã„ã€‚
            </div>

            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="margin-bottom: 15px; color: #333;">ğŸ“¦ ä½œæˆã•ã‚Œã‚‹ã‚¢ã‚¤ã‚³ãƒ³ã®ç¨®é¡</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef;">
                        <h4 style="color: #495057; margin-bottom: 10px;">ğŸ–¥ï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ãƒ»Dockç”¨</h4>
                        <p style="color: #6c757d; font-size: 0.9em;">16Ã—16, 32Ã—32, 64Ã—64px<br>ã‚·ã‚¹ãƒ†ãƒ è¡¨ç¤ºãƒ»å°ã•ãªã‚¢ã‚¤ã‚³ãƒ³</p>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef;">
                        <h4 style="color: #495057; margin-bottom: 10px;">ğŸ“ Finderãƒ»ãƒªã‚¹ãƒˆç”¨</h4>
                        <p style="color: #6c757d; font-size: 0.9em;">128Ã—128, 256Ã—256px<br>ãƒ•ã‚¡ã‚¤ãƒ«è¡¨ç¤ºãƒ»ä¸­ã‚µã‚¤ã‚ºã‚¢ã‚¤ã‚³ãƒ³</p>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef;">
                        <h4 style="color: #495057; margin-bottom: 10px;">ğŸ¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨</h4>
                        <p style="color: #6c757d; font-size: 0.9em;">512Ã—512, 1024Ã—1024px<br>ã‚¢ãƒ—ãƒªã‚¢ã‚¤ã‚³ãƒ³ãƒ»é«˜è§£åƒåº¦è¡¨ç¤º</p>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 12px; background: #e3f2fd; border-radius: 6px;">
                    <strong style="color: #1976d2;">ğŸ’¡ ãƒã‚¤ãƒ³ãƒˆ:</strong> 
                    <span style="color: #1565c0;">Retinaå¯¾å¿œã®ãŸã‚ã€å„ã‚µã‚¤ã‚ºã«é€šå¸¸ç‰ˆã¨@2xç‰ˆãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šå…¨ã¦ã®macOSç’°å¢ƒã§ç¾ã—ãè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</span>
                </div>
            </div>

            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“</div>
                <div class="upload-text">PNGç”»åƒã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</div>
                <div class="upload-subtext">ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</div>
            </div>

            <input type="file" id="fileInput" accept=".png,image/png" style="display: none;">

            <div class="error-message" id="errorMessage"></div>

            <div class="preview-section" id="previewSection">
                <div class="preview-container">
                    <img id="previewImage" class="preview-image" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼">
                    <div class="preview-info">
                        <h3 id="fileName">ãƒ•ã‚¡ã‚¤ãƒ«å</h3>
                        <p id="fileSize">ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º</p>
                        <p id="fileDimensions">ç”»åƒã‚µã‚¤ã‚º</p>
                    </div>
                </div>
            </div>

            <div class="settings-section" id="settingsSection">
                <div class="form-group">
                    <label for="outputName">å‡ºåŠ›åï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰:</label>
                    <input type="text" id="outputName" placeholder="ä¾‹: MyApp, Calculator ãªã©">
                </div>
                <button class="generate-button" id="generateButton">ğŸš€ ã‚¢ã‚¤ã‚³ãƒ³ã‚»ãƒƒãƒˆã‚’ç”Ÿæˆ</button>
            </div>

            <div class="progress-section" id="progressSection">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">æº–å‚™ä¸­...</div>
            </div>

            <div class="results-section" id="resultsSection">
                <h3>ğŸ“± ç”Ÿæˆã•ã‚ŒãŸã‚¢ã‚¤ã‚³ãƒ³ã‚»ãƒƒãƒˆ</h3>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; color: #333;">ğŸ“‹ ãƒ•ã‚¡ã‚¤ãƒ«åã®èª¬æ˜</h4>
                    <div style="font-size: 0.9em; color: #555; line-height: 1.6;">
                        <p><strong>icon_16x16.png</strong> â†’ 16Ã—16pxï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ç”¨ï¼‰</p>
                        <p><strong>icon_16x16@2x.png</strong> â†’ 32Ã—32pxï¼ˆRetinaç‰ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ç”¨ï¼‰</p>
                        <p><strong>icon_32x32.png</strong> â†’ 32Ã—32pxï¼ˆDockå°ã‚µã‚¤ã‚ºç”¨ï¼‰</p>
                        <p><strong>icon_32x32@2x.png</strong> â†’ 64Ã—64pxï¼ˆRetinaç‰ˆDockå°ã‚µã‚¤ã‚ºç”¨ï¼‰</p>
                        <p><strong>icon_128x128.png</strong> â†’ 128Ã—128pxï¼ˆFinderè¡¨ç¤ºç”¨ï¼‰</p>
                        <p><strong>icon_128x128@2x.png</strong> â†’ 256Ã—256pxï¼ˆRetinaç‰ˆFinderç”¨ï¼‰</p>
                        <p><strong>icon_256x256.png</strong> â†’ 256Ã—256pxï¼ˆå¤§ããªã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤ºç”¨ï¼‰</p>
                        <p><strong>icon_256x256@2x.png</strong> â†’ 512Ã—512pxï¼ˆRetinaç‰ˆå¤§ããªã‚¢ã‚¤ã‚³ãƒ³ç”¨ï¼‰</p>
                        <p><strong>icon_512x512.png</strong> â†’ 512Ã—512pxï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ã‚³ãƒ³ç”¨ï¼‰</p>
                        <p><strong>icon_512x512@2x.png</strong> â†’ 1024Ã—1024pxï¼ˆRetinaç‰ˆã‚¢ãƒ—ãƒªã‚¢ã‚¤ã‚³ãƒ³ç”¨ï¼‰</p>
                    </div>
                </div>
                <div class="size-grid" id="sizeGrid"></div>
                <div class="download-section">
                    <h4>ğŸ’¾ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</h4>
                    <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #dee2e6;">
                        <h5 style="margin-bottom: 10px; color: #495057;">ğŸ¯ ç”¨é€”åˆ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¨å¥¨</h5>
                        <div style="font-size: 0.9em; color: #6c757d; line-height: 1.5;">
                            <p><strong>ğŸ–¥ï¸ ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºè€…:</strong> å…¨ã‚µã‚¤ã‚ºãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ â†’ Xcodeã®ã‚¢ã‚»ãƒƒãƒˆã‚«ã‚¿ãƒ­ã‚°ã«é…ç½®</p>
                            <p><strong>ğŸ“± å€‹äººåˆ©ç”¨:</strong> 512Ã—512, 1024Ã—1024ã®ã¿ â†’ ä¸€èˆ¬çš„ãªã‚¢ãƒ—ãƒªç”¨é€”</p>
                            <p><strong>ğŸŒ ã‚¦ã‚§ãƒ–é–‹ç™ºè€…:</strong> 16Ã—16, 32Ã—32, 64Ã—64 â†’ ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ãƒ»å°ã‚¢ã‚¤ã‚³ãƒ³ç”¨</p>
                        </div>
                    </div>
                    <button class="download-button" id="downloadZip">ğŸ“¦ å…¨ã‚µã‚¤ã‚ºãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    <div id="individualDownloads"></div>
                    <button class="reset-button" id="resetButton">ğŸ”„ æ–°ã—ã„ç”»åƒã§å†ä½œæˆ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class MacOSIconGenerator {
            constructor() {
                this.iconSizes = [
                    { size: 16, name: 'icon_16x16.png' },
                    { size: 32, name: 'icon_16x16@2x.png' },
                    { size: 32, name: 'icon_32x32.png' },
                    { size: 64, name: 'icon_32x32@2x.png' },
                    { size: 128, name: 'icon_128x128.png' },
                    { size: 256, name: 'icon_128x128@2x.png' },
                    { size: 256, name: 'icon_256x256.png' },
                    { size: 512, name: 'icon_256x256@2x.png' },
                    { size: 512, name: 'icon_512x512.png' },
                    { size: 1024, name: 'icon_512x512@2x.png' }
                ];
                
                this.generatedImages = [];
                this.originalImage = null;
                this.initEventListeners();
            }

            initEventListeners() {
                const uploadArea = document.getElementById('uploadArea');
                const fileInput = document.getElementById('fileInput');
                const generateButton = document.getElementById('generateButton');
                const downloadZip = document.getElementById('downloadZip');
                const resetButton = document.getElementById('resetButton');

                // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragover');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        this.handleFileSelect(files[0]);
                    }
                });

                // ã‚¯ãƒªãƒƒã‚¯ã§ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
                uploadArea.addEventListener('click', () => {
                    fileInput.click();
                });

                fileInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        this.handleFileSelect(e.target.files[0]);
                    }
                });

                // ç”Ÿæˆãƒœã‚¿ãƒ³
                generateButton.addEventListener('click', () => {
                    this.generateIcons();
                });

                // ZIPãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                downloadZip.addEventListener('click', () => {
                    this.downloadAsZip();
                });

                // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
                resetButton.addEventListener('click', () => {
                    this.reset();
                });
            }

            handleFileSelect(file) {
                // PNGå½¢å¼ãƒã‚§ãƒƒã‚¯
                if (!file.type.includes('png')) {
                    this.showError('PNGå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆ10MBä»¥ä¸‹ï¼‰
                if (file.size > 10 * 1024 * 1024) {
                    this.showError('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ï¼ˆ10MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ï¼‰ã€‚');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        // ç”»åƒã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
                        if (img.width < 512 || img.height < 512) {
                            this.showError('ç”»åƒã‚µã‚¤ã‚ºãŒå°ã•ã™ãã¾ã™ï¼ˆ512Ã—512pxä»¥ä¸Šæ¨å¥¨ï¼‰ã€‚');
                            return;
                        }

                        if (img.width !== img.height) {
                            this.showError('æ­£æ–¹å½¢ã®ç”»åƒã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚');
                            return;
                        }

                        this.originalImage = img;
                        this.showPreview(file, img);
                        this.hideError();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }

            showPreview(file, img) {
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('fileSize').textContent = `${(file.size / 1024 / 1024).toFixed(2)} MB`;
                document.getElementById('fileDimensions').textContent = `${img.width} Ã— ${img.height} px`;
                document.getElementById('previewImage').src = img.src;

                document.getElementById('uploadArea').classList.add('has-file');
                document.getElementById('previewSection').style.display = 'block';
                document.getElementById('settingsSection').style.display = 'block';

                // å‡ºåŠ›åã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®š
                const baseName = file.name.replace(/\.[^/.]+$/, "");
                document.getElementById('outputName').value = baseName;
            }

            async generateIcons() {
                if (!this.originalImage) return;

                const generateButton = document.getElementById('generateButton');
                const progressSection = document.getElementById('progressSection');
                const progressFill = document.getElementById('progressFill');
                const progressText = document.getElementById('progressText');

                generateButton.disabled = true;
                progressSection.style.display = 'block';
                this.generatedImages = [];

                const outputName = document.getElementById('outputName').value || 'icon';

                for (let i = 0; i < this.iconSizes.length; i++) {
                    const iconInfo = this.iconSizes[i];
                    const progress = ((i + 1) / this.iconSizes.length) * 100;

                    progressFill.style.width = `${progress}%`;
                    progressText.textContent = `${iconInfo.size}Ã—${iconInfo.size} ç”Ÿæˆä¸­... (${i + 1}/${this.iconSizes.length})`;

                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = iconInfo.size;
                    canvas.height = iconInfo.size;

                    // é«˜å“è³ªãƒªã‚µã‚¤ã‚º
                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';
                    ctx.drawImage(this.originalImage, 0, 0, iconInfo.size, iconInfo.size);

                    // Blobä½œæˆ
                    const blob = await new Promise(resolve => {
                        canvas.toBlob(resolve, 'image/png', 1.0);
                    });

                    this.generatedImages.push({
                        size: iconInfo.size,
                        name: iconInfo.name,
                        blob: blob,
                        url: URL.createObjectURL(blob)
                    });

                    // å°‘ã—å¾…æ©Ÿï¼ˆUIã®æ›´æ–°ã®ãŸã‚ï¼‰
                    await new Promise(resolve => setTimeout(resolve, 50));
                }

                progressText.textContent = 'å®Œäº†ï¼';
                setTimeout(() => {
                    progressSection.style.display = 'none';
                    this.showResults();
                    generateButton.disabled = false;
                }, 500);
            }

            showResults() {
                const sizeGrid = document.getElementById('sizeGrid');
                const individualDownloads = document.getElementById('individualDownloads');
                
                sizeGrid.innerHTML = '';
                individualDownloads.innerHTML = '';

                this.generatedImages.forEach(img => {
                    // ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤º
                    const sizeItem = document.createElement('div');
                    sizeItem.className = 'size-item';
                    sizeItem.innerHTML = `
                        <img src="${img.url}" alt="${img.size}x${img.size}">
                        <div class="size-label">${img.size}Ã—${img.size}</div>
                        <div class="size-label">${img.name}</div>
                    `;
                    sizeGrid.appendChild(sizeItem);

                    // å€‹åˆ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³
                    const downloadBtn = document.createElement('button');
                    downloadBtn.className = 'download-button';
                    downloadBtn.textContent = `${img.size}Ã—${img.size}`;
                    downloadBtn.onclick = () => this.downloadSingle(img);
                    individualDownloads.appendChild(downloadBtn);
                });

                document.getElementById('resultsSection').style.display = 'block';
            }

            async downloadAsZip() {
                // ç°¡æ˜“ZIPå®Ÿè£…ï¼ˆå®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯JSZipãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨æ¨å¥¨ï¼‰
                const outputName = document.getElementById('outputName').value || 'icon';
                
                // å€‹åˆ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨ã—ã¦å®Ÿè£…
                this.generatedImages.forEach((img, index) => {
                    setTimeout(() => {
                        this.downloadSingle(img);
                    }, index * 200); // å°‘ã—é–“éš”ã‚’ç©ºã‘ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                });
            }

            downloadSingle(img) {
                const a = document.createElement('a');
                a.href = img.url;
                a.download = img.name;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }

            showError(message) {
                const errorDiv = document.getElementById('errorMessage');
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
            }

            hideError() {
                document.getElementById('errorMessage').style.display = 'none';
            }

            reset() {
                // å…¨ã¦ã®URLã‚’è§£æ”¾
                this.generatedImages.forEach(img => {
                    URL.revokeObjectURL(img.url);
                });

                this.generatedImages = [];
                this.originalImage = null;

                // UI ã‚’ãƒªã‚»ãƒƒãƒˆ
                document.getElementById('uploadArea').classList.remove('has-file');
                document.getElementById('previewSection').style.display = 'none';
                document.getElementById('settingsSection').style.display = 'none';
                document.getElementById('progressSection').style.display = 'none';
                document.getElementById('resultsSection').style.display = 'none';
                document.getElementById('fileInput').value = '';
                document.getElementById('outputName').value = '';
                this.hideError();
            }
        }

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
        document.addEventListener('DOMContentLoaded', () => {
            new MacOSIconGenerator();
        });
    </script>
</body>
</html>